/**
 * File:	Write.ycp
 * Package:	Configuration of dns-server
 * Summary:	Testsuite for writting configuration
 * Authors:	Jiri Srain <jsrain@suse.cz>, Lukas Ocilka <locilka@suse.cz>
 * Copyright:	Copyright 2004, Novell, Inc.  All rights reserved.
 *
 * $Id$
 *
 * Testsuite for writting configuration for dns-server
 */

{
    // testedfiles: DnsServer.pm DNSD.pm

    include "testsuite.ycp";
    import "Progress";
    import "DnsServer";
    import "Mode";

    Mode::test = true;

    Progress::off ();

    DnsServer::SetAdaptFirewall (true);

    map READ = $[
	// Runlevel
        "init": $[
            "scripts": $[
                "exists": true,
                "runlevel": $[
                    "named": $[
                        "start": [],
                        "stop":  [],
                        ],
                    ],
                // their contents is not important for ServiceAdjust
                "comment": $[
                    "named": $[],
                    ],
                ],
            ],

	"target" : $[
	    "stat" : $[],
	    "ycp" : $[],
	],
	"dns" : $[
	    "named" : $[
		"section" : $[
		    "options" : "",
		    "zone \"localhost\" in" : "",
		],
		"value" : $[
		    "options" : $[
			"directory" : "\"/var/lib/named\"",
			"notify" : "no",
			"xxx" : "yyy",
		    ],
		    "zone \"localhost\" in" : $[
			"type" : "master",
			"file" : "\"localhost.zone\"",
		    ],
		],
	    ],
	    "zone" : $[
		"TTL":"1W",
		"records":[
		    $[
			"key":"",
			"type":"NS",
			"value":"@"
		    ], $[
			"key":"",
			"type":"A",
			"value":"127.0.0.1"
		    ], $[
			"key" : "localhost2",
			"type" : "A",
			"value" : "127.0.0.2"
		    ],
		],
		"soa":$[
		    "expiry":"6W",
		    "mail":"root",
		    "minimum":"1W",
		    "refresh":"2D",
		    "retry":"4H",
		    "serial":42,
		    "server":"@",
		    "zone":"@"
		]
	    ],
	],
	"sysconfig" : $[
	    "SuSEfirewall2" : $[
		"FW_SERVICE_DNS" : "no",
		"FW_SERVICE_DHCLIENT" : "no",
		"FW_SERVICE_DHCPD" : "no",
		"FW_SERVICE_SQUID" : "no",
		"FW_SERVICE_SAMBA" : "no",
	    ],
	],
    ];
    map WRITE = $[];
    map EXEC = $[
	"target" : $[
	    "bash_output" : $["exit" : 0, "stdout" : "20030806"],
	],
    ];

    DUMP ("=======================");
    TEST (``(DnsServer::Import ($[
	"chroot":false,
	"options":[
	    $[
		"key" : "directory",
		"value":"\"/var/lib/named\"",
	    ],
	    $[
		"key" : "notify",
		"value":"no"
	    ],
	],
	"start_service":false,
	"zones":[
	    $[
		"file":"example.com",
		"records":[
		    $[
			"key" : "localhost",
			"type" : "A",
			"value" : "127.0.0.1",
		    ],
		    $[
			"key" : "localhost",
			"type" : "NS",
			"value" : "127.0.0.1",
		    ],
		    $[
			"key" : "localhost2",
			"type" : "A",
			"value" : "127.0.0.2",
		    ],
		],
		"soa":$[
		    "expiry":"6W",
		    "mail":"root",
		    "minimum":"1W",
		    "refresh":"2D",
		    "retry":"4H",
		    "serial":42,
		    "server":"@",
		    "zone":"@"
		],
		"ttl":"1W",
		"type":"master",
		"zone":"example.com",
		"modified" : true,
	    ]
	]])), [], 0);
    DUMP ("=======================");
    TEST (``(DnsServer::Write ()), [READ, WRITE, EXEC], 0);
}
